---
title: "JWT를 잘 사용하는 방법 (1)"
date: 2022-12-29 10:28:16 +0900
toc: true
toc_sticky: true
categories: [JWT, Java, Spring Boot]
---

## 세차새차 개발 일지 시리즈

세차새차 프로젝트에서 JWT와 관련된 버그를 수정하던 도중에, 동료분에게 유튜브 영상을 추천받았다. [JWT 대충 쓰면 님들 코딩인생 끝남 - 코딩애플](https://www.youtube.com/watch?v=XXseiON9CV0)
올라온 지 하루밖에 되지 않은 따끈따끈한 영상이기에 바로 영상에 나온 내용을 정리하고, 프로젝트에 적용해야겠다고 마음먹었다. 

## Cookie, Session과 Token 방식의 클라이언트 식별

HTTP는 Stateless하다. 이는 서버가 클라이언트들의 정보를 기억하지 않고, 오직 지금 요청받은 통신에 대한 처리만 진행한다는 것이다. 따라서 일반적으로 로그인이 필요한 기능들,
특정 클라이언트에게 특정 서비스를 제공하고자 할 때는 서버가 클라이언트를 식별할 방법이 필요하다.

### 1. Cookie 방식은 클라이언트가 인증 정보를 보관한다

클라이언트에 자신의 인증 정보를 담은 Cookie를 전송하고, 클라이언트가 이를 매 요청마다 첨부하여 통신하는 방식이다. 

### 2. Session 방식은 서버가 인증 정보를 보관한다

Session 방식의 경우 클라이언트가 서버에 로그인을 진행하면, 서버는 이 인증 정보를 세션 저장소에 저장하고, 세션ID를 담고 있는 HTTP 쿠키를 클라이언트에 전송한다. 
따라서 클라이이언트가 해당 쿠키를 포함하여 클라이언트가 서버에 요청을 보내면, 서버는 세션ID에 따라서 세션 저장소를 열어보고 클라이언트의 인증 정보를 확인하게 된다.

### 3. Token 방식은 토큰 자체로 완전하다 

Token 방식은 서버가 유저의 인증 정보를 토큰화하여 클라이언트에게 보낸다. 클라이언트는 이 토큰을 매 요청과 함께 서버에 전송하고, 서버는 이를 확인하여 인증 정보를 확인한다.
인증 정보가 클라이언트측으로 이동하기 때문에, 클라이언트가 인증 정보를 임의로 수정하는 것을 방지하기 위해서 서버는 토큰 속 인증 정보와, 서버 측 비밀키를 결합한 서명을 추가한다.
따라서 세션 방식과 같은 세션 저장소가 필요하지도 않고, 쿠키 방식과 같이 브라우저에 종속되지도 않으므로, 더욱 자유롭게 사용할 수 있다.

## JWT는 이렇게 사용하면 안 된다

결국 Token 방식의 일종인 JWT는, 결국 클라이언트에게 위험한 인증 정보를 보관해야 하니 여러 취약점들이 생길 수 있고, 이에 세션 방식보다 더욱 민감하게 관리하여야 한다. 
위 코딩애플님의 무시무시한 제목을 가진(...) 영상에 나온 내용을 간략하게 정리하자면 다음과 같다.

### 1. JWT None Algorithm 공격에 취약하게 코드를 작성한다

### 2. 서버 시크릿 키를 너무 쉽게 설정하거나, 무분별하게 관리한다

### 3. JWT의 PAYLODE에 클라이언트에 공유하면 안 되는 민감한 정보를 담는다

### 4. JWT의 유효기간을 너무 길게 설정한다


다음 포스트부터는 왜 각각의 취약점이 어떤 원리로 인해 문제가 발생하는지 설명하면서, 실제로 개발 중인 세차새차 프로젝트 코드에 적용해보도록 하겠다.
